<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sewing Order Manager</title>

<style>
body { font-family: Arial, sans-serif; background: #f4f4f6; padding: 20px; }
h1 { text-align:center; color:#4b2c6f; }
.hidden { display:none; }

.login-box { max-width:400px; margin:80px auto; background:white; padding:25px; border-radius:8px; text-align:center; }
.login-box input, button { padding:10px; width:100%; margin-top:10px; }

button { cursor:pointer; border:none; border-radius:6px; }
button.save { background:#6b3fa0; color:white; }
.logout { background:#555; color:white; }

form {
  background:white;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}

.summary-bar {
  display:flex;
  justify-content:space-around;
  background:#e0e0e0;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  font-weight:bold;
}

.filters { display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap; }

table {
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:8px;
}

th, td {
  padding:10px;
  border-bottom:1px solid #ddd;
  text-align:center;
}

th { background:#6b3fa0; color:white; }
td[contenteditable="true"] { background:#f9f9f9; }

.unpaid { background:#ffe0e0; }
.overdue { background:#ffd6d6; }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" class="login-box">
  <h2>Login</h2>
  <input type="password" id="loginCode" placeholder="Access code">
  <button id="loginBtn">Login</button>
  <p id="loginError" style="color:red;"></p>
</div>

<!-- APP -->
<div id="app" class="hidden">
<h1>Sewing Orders</h1>

<div class="summary-bar">
  <div>Total Badges: <span id="totalBadges">0</span></div>
  <div>Total Payment: £<span id="totalPayment">0.00</span></div>
  <div>Completed Orders: <span id="completedOrders">0</span></div>
</div>

<div class="filters">
  <input id="searchInput" placeholder="Search">
  <select id="statusFilter">
    <option value="All">All Statuses</option>
    <option>Awaiting Drop-off</option>
    <option>Ongoing</option>
    <option>Completed</option>
  </select>
  <button onclick="setPaymentFilter('All')">All Orders</button>
  <button onclick="setPaymentFilter('No')">Unpaid</button>
  <button onclick="setPaymentFilter('Yes')">Paid</button>
  <button class="logout" id="logoutBtn">Logout</button>
</div>

<form id="orderForm">
  <input id="name" placeholder="Customer Name" required>
  <input type="number" id="badges" placeholder="Number of badges" required>
  <input id="payment" placeholder="Min Payment (£)" readonly>
  <input type="number" step="0.01" id="additionalPayment" placeholder="Additional Payment (£)">
  <input type="date" id="dropoff">
  <input type="date" id="collection">
  <select id="status">
    <option>Awaiting Drop-off</option>
    <option>Ongoing</option>
    <option>Completed</option>
  </select>
  <select id="paid">
    <option value="No">Not Paid</option>
    <option value="Yes">Paid</option>
  </select>
  <button class="save">Save Order</button>
</form>

<table>
<thead>
<tr>
  <th>Name</th>
  <th>Badges</th>
  <th>Min Payment</th>
  <th>Additional Payment</th>
  <th>Drop-off</th>
  <th>Collection</th>
  <th>Status</th>
  <th>Paid</th>
</tr>
</thead>
<tbody id="orderTable"></tbody>
</table>
</div>

<script>
const ACCESS_CODE = "WSJ2027";
let orders = JSON.parse(localStorage.getItem("sewingOrders")) || [];
let paymentFilter = "All";

// LOGIN
loginBtn.onclick = () => {
  if(loginCode.value === ACCESS_CODE){
    sessionStorage.setItem("loggedIn","true");
    loginScreen.classList.add("hidden");
    app.classList.remove("hidden");
    renderOrders();
  } else loginError.textContent = "Wrong code";
};

logoutBtn.onclick = () => { sessionStorage.clear(); location.reload(); };

if(sessionStorage.getItem("loggedIn")){
  loginScreen.classList.add("hidden");
  app.classList.remove("hidden");
  renderOrders();
}

// BADGE PAYMENT
badges.oninput = () => {
  payment.value = `£${(badges.value * 0.5).toFixed(2)}`;
};

function saveOrders(){
  localStorage.setItem("sewingOrders", JSON.stringify(orders));
}

// RENDER
function renderOrders(){
  orderTable.innerHTML = "";

  // TOTALS (ALL ORDERS)
  let totalBadges = 0, totalPayment = 0, completed = 0;
  orders.forEach(o => {
    totalBadges += o.badges;
    if(o.paid === "Yes"){
      totalPayment += (o.badges * 0.5) + o.additionalPayment;
    }
    if(o.status === "Completed") completed++;
  });

  totalBadgesEl.textContent = totalBadges;
  totalPaymentEl.textContent = totalPayment.toFixed(2);
  completedOrdersEl.textContent = completed;

  // DISPLAY
  orders.forEach((o, i) => {
    if(statusFilter.value !== "All" && o.status !== statusFilter.value) return;
    if(paymentFilter !== "All" && o.paid !== paymentFilter) return;
    if(!o.name.toLowerCase().includes(searchInput.value.toLowerCase())) return;

    const tr = document.createElement("tr");
    if(o.paid === "No") tr.classList.add("unpaid");

    const cells = [
      o.name,
      o.badges,
      `£${(o.badges * 0.5).toFixed(2)}`,
      `£${o.additionalPayment.toFixed(2)}`,
      o.dropoff,
      o.collection,
      o.status,
      o.paid
    ];

    cells.forEach((val, idx) => {
      const td = document.createElement("td");
      td.textContent = val;
      if(idx !== 2){
        td.contentEditable = true;
        td.onblur = () => {
          let text = td.textContent.replace("£","").trim();
          if(idx === 1) o.badges = parseInt(text)||0;
          else if(idx === 3) o.additionalPayment = parseFloat(text)||0;
          else if(idx === 7) o.paid = text;
          else if(idx === 6) o.status = text;
          else if(idx === 0) o.name = text;
          saveOrders();
          renderOrders();
        };
      }
      tr.appendChild(td);
    });

    orderTable.appendChild(tr);
  });
}

// FORM
orderForm.onsubmit = e => {
  e.preventDefault();
  orders.push({
    name: name.value,
    badges: parseInt(badges.value),
    additionalPayment: parseFloat(additionalPayment.value)||0,
    dropoff: dropoff.value,
    collection: collection.value,
    status: status.value,
    paid: paid.value
  });
  saveOrders();
  orderForm.reset();
  renderOrders();
};

function setPaymentFilter(v){ paymentFilter=v; renderOrders(); }

searchInput.oninput = renderOrders;
statusFilter.onchange = renderOrders;
</script>
</body>
</html>
